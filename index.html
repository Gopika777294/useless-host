<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KIRA BOT ü§ñ (Gemini)</title>
  <style>
    /* Floating emoji animation */
    .emoji {
      position: fixed;
      bottom: -50px;
      font-size: 2rem;
      animation: floatUp 8s linear infinite;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes floatUp {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-120vh) scale(1.5); opacity: 0; }
    }
    body {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
      padding: 20px;
      border-radius: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 100%;
      z-index: 1;
      position: relative;
      border: 4px dashed rgba(255,255,255,0.6);
      backdrop-filter: blur(10px);
    }
    h1 {
      text-align: center;
      color: #fff;
      font-size: 2.2rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .controls {
      text-align: center;
      margin-bottom: 10px;
    }
    #clearBtn {
      background: #ff6f91;
      border: none;
      padding: 8px 15px;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    .chat {
      background: rgba(255,255,255,0.3);
      padding: 15px;
      border-radius: 15px;
      height: 300px;
      overflow-y: auto;
      border: 2px solid rgba(255,255,255,0.5);
    }
    .chat-form {
      display: flex;
      margin-top: 10px;
    }
    #userInput {
      flex: 1;
      padding: 10px;
      border-radius: 10px 0 0 10px;
      border: none;
      outline: none;
    }
    #sendBtn {
      background: #6a82fb;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 0 10px 10px 0;
      cursor: pointer;
      font-weight: bold;
    }
    .bubble.bot {
      background: #fff;
      border-radius: 10px;
      padding: 5px 10px;
      margin: 5px 0;
    }
    .bubble.me {
      background: #d1ffd6;
      border-radius: 10px;
      padding: 5px 10px;
      margin: 5px 0;
      text-align: right;
    }
  </style>
</head>
<body>
  <!-- Floating emojis -->
  <div class="emoji" style="left: 5%;">üçé</div>
  <div class="emoji" style="left: 15%; animation-delay: 1s;">üçå</div>
  <div class="emoji" style="left: 25%; animation-delay: 2s;">üçì</div>
  <div class="emoji" style="left: 35%; animation-delay: 3s;">üçç</div>
  <div class="emoji" style="left: 45%; animation-delay: 4s;">üçá</div>
  <div class="emoji" style="left: 55%; animation-delay: 5s;">ü•≠</div>
  <div class="emoji" style="left: 65%; animation-delay: 6s;">üçâ</div>
  <div class="emoji" style="left: 75%; animation-delay: 7s;">üçí</div>
  <div class="emoji" style="left: 85%; animation-delay: 8s;">üçë</div>
  <div class="emoji" style="left: 95%; animation-delay: 9s;">üçã</div>

  <main class="container">
    <h1>KIRA BOT ü§ñ</h1>
    <div class="controls">
      <button id="clearBtn">Clear chat</button>
    </div>
    <section id="chat" class="chat" aria-live="polite"></section>
    <form id="chatForm" class="chat-form" onsubmit="return false;">
      <input id="userInput" autocomplete="off" placeholder="Say something..." />
      <button id="sendBtn">Send</button>
    </form>
  </main>

<script>
const API_KEY = "AIzaSyAdToYxBNYnoxcWy29EABRjQks9ED7OyjU"; // Replace with your actual API key

const chat = document.getElementById('chat');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');

function addBubble(text, who = 'bot') {
  const el = document.createElement('div');
  el.className = 'bubble ' + (who === 'me' ? 'me' : 'bot');
  el.innerHTML = text;
  chat.appendChild(el);
  chat.scrollTop = chat.scrollHeight;
}

function randomEmoji() {
  const emojis = ["üòÇ", "üôÉ", "ü¶Ñ", "üçï", "üî•", "ü§°", "ü•¥", "üëÄ", "üí©", "üòú", "ü™©", "ü§Ø"];
  return emojis[Math.floor(Math.random() * emojis.length)];
}

// Fallback responses when API fails
const funnyReplies = [
  "Oh sure, let me just consult my crystal ball üîÆ... yep, still no idea.",
  "Wow, deep question... have you tried asking your toaster?",
  "Hold up, I need coffee before I answer that ‚òï.",
  "That's above my pay grade, ask Google‚Ä¶ or your cat.",
  "Oh absolutely... if we were in an alternate universe üåå.",
  "Bruh. Just‚Ä¶ bruh.",
  "Plot twist: I'm actually a potato ü•î.",
  "Do you want the short answer or the overcomplicated nonsense one?",
  "If I answer this, do I get pizza?",
  "You're speaking to an AI, not Gandalf."
];

async function getResponse(text) {
  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{
          parts: [{
            text: `Answer in a sarcastic, funny tone with random jokes. Keep it brief and entertaining: ${text}`
          }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 40,
          topP: 0.95,
          maxOutputTokens: 1024,
        },
        safetySettings: [
          {
            category: "HARM_CATEGORY_HARASSMENT",
            threshold: "BLOCK_ONLY_HIGH"
          },
          {
            category: "HARM_CATEGORY_HATE_SPEECH", 
            threshold: "BLOCK_ONLY_HIGH"
          },
          {
            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
            threshold: "BLOCK_ONLY_HIGH"
          },
          {
            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
            threshold: "BLOCK_ONLY_HIGH"
          }
        ]
      })
    });

    if (!response.ok) {
      const errorText = await response.text();
      console.error("HTTP Error:", response.status, errorText);
      throw new Error(`HTTP ${response.status}: ${errorText}`);
    }

    const data = await response.json();
    console.log("Gemini API response:", data);

    // Check for blocked content first
    if (data.candidates && data.candidates[0] && data.candidates[0].finishReason === "SAFETY") {
      console.log("Content was blocked by safety filters");
      throw new Error("Content blocked by safety filters");
    }

    // Check for valid response
    if (data.candidates && data.candidates.length > 0 && 
        data.candidates[0].content && data.candidates[0].content.parts && 
        data.candidates[0].content.parts.length > 0) {
      const aiResponse = data.candidates[0].content.parts[0].text;
      return `${aiResponse} ${randomEmoji()} ${randomEmoji()}`;
    } else if (data.error) {
      console.error("API Error:", data.error);
      throw new Error(data.error.message || "API returned an error");
    } else {
      console.error("Unexpected response structure:", data);
      throw new Error("No valid response from AI");
    }
  } catch (error) {
    console.error("Error calling Gemini API:", error);
    
    // Return a funny fallback response
    const fallback = funnyReplies[Math.floor(Math.random() * funnyReplies.length)];
    return `${fallback} ${randomEmoji()} ${randomEmoji()}`;
  }
}

function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addBubble(text, 'me');
  input.value = '';

  const typingEl = document.createElement('div');
  typingEl.className = 'bubble bot';
  typingEl.textContent = "KIRA BOT is thinking...";
  chat.appendChild(typingEl);
  chat.scrollTop = chat.scrollHeight;

  getResponse(text).then(reply => {
    chat.removeChild(typingEl);
    addBubble(reply, 'bot');
  }).catch(error => {
    console.error("Error in sendMessage:", error);
    chat.removeChild(typingEl);
    const fallback = funnyReplies[Math.floor(Math.random() * funnyReplies.length)];
    addBubble(`${fallback} ${randomEmoji()} ${randomEmoji()}`, 'bot');
  });
}

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
clearBtn.addEventListener('click', () => {
  chat.innerHTML = '';
  addBubble("Say hi to KIRA BOT! ü§™", 'bot');
});

addBubble("Say hi to KIRA BOT! ü§™", 'bot');
</script>
</body>
</html>
